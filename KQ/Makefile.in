## -*- makefile -*- ###########################################################
#                                                                             #
#  Configuration stuff. You can change what is here as you wish. Just try to  #
#  make sense with all you write ;)                                           #
#                                                                             #
#  DEBUG=1       : Build a debugging library and/or examples                  #
#  PROFILE=1     : Build a profiling library and/or examples                  #
#                                                                             #
#  If you define both PROFILE and DEBUG, the last one will be used (make      #
#  PROFILE=1 DEBUG=1 will build a debugging library).                         #
#                                                                             #
#  KQ_CHEATS=1   : Compile extra cheat code for testing only                  #
#  KQ_USE_JGMOD  : Use JGMOD for music, otherwise use DUMB                    #
#  KQ_USE_2XSAI  : Use 2xSAI to smooth the stretched screen (prob won't       #
#                                                            work)            #
#  ReyBrujo, 2002                                                             #
#                                                                             #
#  17-Sep-2002 (PH) Added cheat mode, tested on Linux, added script makefile  #
#                                                                             #
###############################################################################

CC:= @CC@
HOST:=@host@

#                                                                             #
#  Basic package information.                                                 #
#                                                                             #
ID_SHORT := @PACKAGE_NAME@
VERSION  := @PACKAGE_VERSION@
ID_LONG  := "@PACKAGE_STRING@"

#                                                                             #
#  Set the different programs we will be using. You must supply them all if   #
#  you have access to them. I think UPX (executable compressor) and GPP are   #
#  the only ones that might bring problems. If you don't have UPX, set it to  #
#  nothing.                                                                   #
#  GPP is the preprocessor program. It usually switches between 'gpp' and     #
#  'cpp'.                                                                     #
#  If you have pkzip rather than zip (traitor!) configure the variables to    #
#  match the executable and its flags.                                        #
#                                                                             #

#                                                                             #
#  Directory names. You should not change them unless you change their names  #
#  (why you would do something like that? ;)                                  #
#                                                                             #
SRC_DIR := src
OBJ_DIR := obj
BIN_DIR := bin
DOC_DIR := docs
MAK_DIR := mkfiles
INC_DIR := include
SCR_DIR := scripts

KQ_USE_JGMOD:=@kq_use_jgmod@
KQ_USE_2xSAI:=@kq_use_2xsai@


#                                                                             #
#  Default flags. CFLAGS are the compilation flags for C. CXXFLAGS are used   #
#  for C++ compilation. LDFLAGS are the library flags, which should be empty  #
#  now (unless you need to link your executable with another library).        #
#  TGZFLAGS are passed as flags to your TGZ executable, and the ZIPFLAGS...   #
#  guess!                                                                     #
#  DEPFLAGS are the flags used to build the dependencies.                     #
#                                                                             #
CFLAGS   := -Wall -W -I $(INC_DIR) -I. @DEFS@
DEPFLAGS := -MM -MG -I$(INC_DIR) -DKQ_SCAN_DEPEND
LDFLAGS  :=
TGZFLAGS := cvzf
ZIPFLAGS := -r -v
RMFLAGS  := -f

ifeq (@kq_use_cheats@,1) 
	CFLAGS += -DKQ_CHEATS
endif

ifdef KQ_USE_JGMOD
	CFLAGS += -DKQ_USE_JGMOD
else
	CFLAGS += -DKQ_USE_DUMB
endif

ifdef KQ_USE_2XSAI
	CFLAGS += -DKQ_USE_2XSAI
endif


#                                                                             #
#  The extra libraries we need to compile the program. Just the base name.    #
#              
LDLIBS+= @LIBS@
LIBRARY:=

ifdef KQ_USE_JGMOD
	LIBRARY += jgmod
else
	LIBRARY += aldmb 
endif

ifdef KQ_USE_2XSAI
	LIBRARY += 2xsai
endif



#                                                                             #
#  Use these extensions.                                                      #
#                                                                             #
EXE_SUFFIX := 
SRC_SUFFIX := c
OBJ_SUFFIX := o
OBJDIR:= $(OBJ_DIR)/@kq_target_dir@

# Use these explicit files:
EXTRAFILES:=@kq_extra_src@

#                                                                             #
#  Finally, add to the standard flags the options, according to the type of   #
#  linking we are looking for.                                                #
#                                                                             #
ifeq (@kq_use_debug@,1)
	CFLAGS   += -g3 -ggdb3 -gstabs3 -DDEBUGMODE
	LDFLAGS  += -g3 -ggdb3 -gstabs3 -DDEBUGMODE
	ALLEGRO  := `allegro-config --shared debug`
else
	ifeq (@kq_use_profile@,1)
		CFLAGS   += -pg
		LDFLAGS  += -pg
		ALLEGRO  := `allegro-config --shared profile`
	else
		LDFLAGS  += -s
		CFLAGS   += -O2
		ALLEGRO  := `allegro-config --shared release`
	endif
endif

#
# Main target: (this comes here so we know it's the first target)
#

all: game scripting editor


#                                                                             #
#  Convert all libraries needed so that GCC can understand them.              #
#                                                                             #
LDFLAGS += $(addprefix -l, $(LIBRARY)) $(LDLIBS) $(ALLEGRO)

include mkfiles/makefile.all
-include $(OBJDIR)/makefile.dep
